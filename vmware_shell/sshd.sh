#!/bin/bash
port=1002
#写入公钥到.ssh目录
mkdir /root/.ssh 2> /dev/null
cat <<EOF > /root/.ssh/authorized_keys
ssh-dss AAAAB3NzaC1kc3MAAACBAPVFCMe1agMyMwSIPTTr5xh4wYa1LJVMbIU0HvtcRXB+FvYgEqIqgHOZVolpVe1RFiqnET5GnYcFi5YV93uHBE6YpxGMrjg0EMt/bScS+nXyzJpbPqwWy0WHEbPJMZEHd6wMroRcOrdhAAqzczU6QnQffbIP0f/EXS4Ill/tFnOHAAAAFQDSeJvDGS+XItq0oKMg2ZHYrO9HPwAAAIAn9uBAhd3id5MybgdzkUXPUK2RVte/K9QLXx1s0iRrMYtd4A8znLyvcU0NOeyz/KFkynnnGW3GzpVjXLgl1w1a8ODC5qyN68cweQJ7Y+M2N014L3h9hx/gaownkvdbm7Oqk8XpRankXC7/vuwstsjN8Py8E+EKna5Qc60TNbtQRAAAAIADRzvsB6M+2HEJVwjmr1DTxwjhI+t66W1NuY8/NmxA7BWouIs7VaGB6qTsyo6muAHT+c+BWfVd9cJneRZSp9rtQeSBq3GFlsLBYocyz2Y8K8BHLpb7T+DxWbMV8Rajkx8gTsM3uiyOZeq4pqk6JZzK1jccjlMbGFOk/NGOi2lYkw==
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCtPYJzWL0p9wfL+uCy+qEmMyqDam0ZDnc+2uoI5TkElYFD15tpPpyOa2flKr3bkt2EY2zuO78I3WlIb56ey+zvjy/hjXucs2m6sb6lkxOHEMo5RmYPo/vDXyvt3URrqHeP+nHFBtu/rJku23rvDsS5Yn+3/A5Hi6PLi6u8Lp/BT4gScwzG9z7GhTNFO7NEXn2RBjsnX895sO1hOMxiut2satyR5ewXGtANHsjkgqv4KaZutAR8dGx0A9ZRUVOGZlSuCldc5GkOXvZ6n5Dgp42SCOW6++ZKRUfOm87CKhHLgJMde0TY33y7Jq/VFLd/aJOAUQy+rTGn39mq4a1np+JP root@node1
EOF
#修改sshd配置
sed -i "s/#Port 22/Port $port/g" /etc/ssh/sshd_config
sed -i "s/PasswordAuthentication yes/PasswordAuthentication no/g" /etc/ssh/sshd_config
#重启sshd
systemctl restart sshd
exit 0